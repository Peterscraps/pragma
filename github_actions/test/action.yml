name: Build
description: 'Build library'
inputs:
  root_dir:
    description: 'Root directory'
    required: true
  should_checkout:
    description: 'Checkout the core library?'
    required: true
    default: '1'
  dir:
    description: 'Library directory'
    required: true
    default: 'core/shared'
runs:
  using: "composite"
  steps:
    - name: Initialize Env
      id: init-env
      uses: Silverlan/common_actions/set_common_env_vars@main

    - shell: bash
      run: |
        echo "Building submodule..."

    ############################## WORKS ##############################
    # Write cache test
    #- name: Build submodule
    #  uses: Silverlan/common_actions/build_submodule@actions
    #  with:
    #    repo: 'https://github.com/Silverlan/test_shared_library'
    #    repo_name: 'test_shared_library'
    #    repo_branch: 'main'
    #    build_target: test_shared_library
        
    #- name: Write cache
    #  uses: actions/cache@v2
    #  with:
    #    path: "D:/a/pragma/pragma/**/*.dll"
    #    key: test-cache-file13
    
    # Read cache test
    #- name: Get cached file
    #  uses: actions/cache@v2
    #  id: get-cached-file
    #  with:
    #    path: "D:/a/pragma/pragma/**/*.dll"
    #    key: test-cache-file13
    ############################## WORKS ##############################
    
    # Write cache test
    #- name: Build submodule
    #  uses: Silverlan/common_actions/build_submodule@actions
    #  with:
    #    repo: 'https://github.com/Silverlan/test_shared_library'
    #    repo_name: 'test_shared_library'
    #    repo_branch: 'main'
    #    build_target: test_shared_library
        
    #- name: Write cache
    #  uses: actions/cache@v2
    #  with:
    #    path: |
    #      "D:/a/pragma/pragma/**/*.dll"
    #      "D:/a/pragma/pragma/**/*.lib"
    #    key: test-cache-file14
    
    # Read cache test
    - name: Get cached file
      uses: actions/cache@v2
      id: get-cached-file
      with:
        path: |
          "D:/a/pragma/pragma/**/*.dll"
          "D:/a/pragma/pragma/**/*.lib"
        key: test-cache-file14
            
    - name: Print files
      shell: bash
      run: |
        echo "Cache hit: ${{steps.get-cached-file.outputs.cache-hit}}"
        cd "D:/a/pragma/pragma"
        ls -R
        
    - shell: bash
      run: |
        echo "Done!"
